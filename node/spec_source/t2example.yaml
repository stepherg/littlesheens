name: t2example
doc: none
parsepatterns: true
nodes:
  start:
    branching:
      branches:
        - target: generateNow

  generateNow:
    action:
      interpreter: ecmascript
      source: |-
        _.log("******hey there******", 45);
        _.out({"go":"way"});
        return _.bindings;
    branching:
      branches:
        - target: firstInterval
          timer: 300

  firstInterval:
    action:
      interpreter: ecmascript
      source: |-
        console.log("hey there");
        _.out({timer: 2});
        _.bindings.count++;
        return _.bindings;
    branching:
      branches:
        - pattern: |
            {"timer":"?id"}
          target: periodic
          timer: 300

  periodic:
    action:
      interpreter: ecmascript
      source: |-
        _.out({"action":"generateReport()"});
        return _.bindings;
    branching:
      branches:
        - pattern: |
            {"timer":"?id"}
          guard:
            interpreter: ecmascript
            source: |-
              var bs = _.bindings;
              var f = parseFloat(bs["?id"]);
              if (isNaN(f)) {
                return "";
              }
              bs["?x"] = f;
              return bs;
          timer: 86400
          target: periodic

  stop:
    action:
      interpreter: ecmascript
      source: |-
        _.out({"action":"stop"});
        return _.bindings;
